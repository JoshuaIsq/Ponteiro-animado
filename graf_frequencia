import numpy as np
import time
import flet as ft
# --- ESTADO DO SISTEMA ---


def main(page: ft.Page):

    #CONFIGURAÇÃO DA PAGINA 
    page.title("Velocimetro da senoide")
    page.theme_mode = page.theme_mode = ft.ThemeMode.DARK

    #VARIAVEIS DE ESTADO
    velocidade_atual = 0.1 
    ultimo_valor_velocidade = 0.1 # Para lembrar a velocidade quando despausar
    fase = 0


    texto_velocimetro = ax.text(0.2, 1.2, f"Velocidade: {velocidade_atual:.2f}", fontsize=12, color='red')
    speed_bar = ft.progressb

# Configuração da Figura
fig, ax = plt.subplots()
plt.title("Controle de Frequência (Setas = Acelera/Freia | Espaço = Trava)")
ax.set_ylim(-1.5, 1.5) # Travando o eixo Y para focar na onda

# Criando eixos e linha
x = np.arange(0, 10, 0.05)
linha, = plt.plot(x, np.sin(x))
plt.grid(True)


def on_keyboard(event):
    global velocidade_atual, ultimo_valor_velocidade
    
    # ESPAÇO: Trava a onda (Vira constante) ou Destrava
    if event.key == ' ':
        if velocidade_atual != 0:
            ultimo_valor_velocidade = velocidade_atual # Guarda a velocidade antes de zerar
            velocidade_atual = 0
        else:
            velocidade_atual = ultimo_valor_velocidade # Recupera a velocidade
            
    # SETA CIMA: Aumenta a frequência (acelera)
    elif event.key == 'up':
        velocidade_atual += 0.05
        
    # SETA BAIXO: Diminui a frequência (freia)
    elif event.key == 'down':
        velocidade_atual -= 0.05
        # Opcional: impedir velocidade negativa (inverter onda)
        if velocidade_atual < 0: velocidade_atual = 0

    # Atualiza o texto na tela (nosso "velocímetro" provisório)
    texto_velocimetro.set_text(f"Velocidade (Freq): {velocidade_atual:.2f}")

# Conectar teclado
fig.canvas.mpl_connect('key_press_event', on_keyboard)

def animate(i):
    global fase
    
    # A mágica física: A fase acumula a velocidade atual a cada quadro
    fase += velocidade_atual
    
    # O gráfico é seno(x + fase acumulada)
    linha.set_ydata(np.sin(x + fase))
    
    return linha, texto_velocimetro

# Blit=True para performance
anim = FuncAnimation(fig, animate, interval=30, blit=True)

plt.show()